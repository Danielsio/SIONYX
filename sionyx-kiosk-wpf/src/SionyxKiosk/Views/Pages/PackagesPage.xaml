<Page x:Class="SionyxKiosk.Views.Pages.PackagesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="clr-namespace:SionyxKiosk.Views.Controls"
      Title="×—×‘×™×œ×•×ª" FlowDirection="RightToLeft">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0">
        <StackPanel Margin="24,0,24,24">
            <controls:PageHeader Title="×—×‘×™×œ×•×ª" Subtitle="×‘×—×¨ ×—×‘×™×œ×” ×©×ž×ª××™×ž×” ×œ×š" Margin="0,0,0,28" />

            <!-- Loading -->
            <controls:LoadingSpinner HorizontalAlignment="Center"
                                     Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" />

            <!-- Empty state -->
            <controls:EmptyState Message="××™×Ÿ ×—×‘×™×œ×•×ª ×–×ž×™× ×•×ª"
                                 Visibility="{Binding ShowEmptyState, Converter={StaticResource BoolToVis}}" />

            <!-- Package grid - responsive -->
            <ItemsControl ItemsSource="{Binding Packages}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="3" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="CardRoot" Background="White"
                                CornerRadius="16" Margin="10" Padding="0" Cursor="Hand"
                                BorderBrush="#E8ECF4" BorderThickness="1.5"
                                MinHeight="320">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="16" ShadowDepth="3" Direction="270"
                                                  Color="#0F172A" Opacity="0.06" />
                            </Border.Effect>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Card header with price -->
                                <Border Grid.Row="0" Padding="28,24,28,20"
                                        CornerRadius="16,16,0,0">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#F5F3FF" Offset="0" />
                                            <GradientStop Color="#EEF2FF" Offset="1" />
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!-- Name + discount badge -->
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                            <TextBlock Text="{Binding Name}" FontSize="22" FontWeight="Bold"
                                                       Foreground="#1E293B" VerticalAlignment="Center" />
                                            <!-- Discount badge -->
                                            <Border CornerRadius="6" Padding="8,3" Margin="10,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Visibility="{Binding HasDiscount, Converter={StaticResource BoolToVis}}">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                        <GradientStop Color="#10B981" Offset="0" />
                                                        <GradientStop Color="#059669" Offset="1" />
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                                <TextBlock Text="{Binding DiscountPercent, StringFormat='{}{0:F0}% ×”× ×—×”'}"
                                                           FontSize="12" FontWeight="Bold" Foreground="White" />
                                            </Border>
                                        </StackPanel>

                                        <!-- Price row -->
                                        <StackPanel Grid.Row="1" Orientation="Horizontal"
                                                    VerticalAlignment="Bottom">
                                            <!-- Main price (uses FinalPrice if discount, else Price) -->
                                            <TextBlock FontSize="42" FontWeight="ExtraBold" Margin="0,0,0,-4">
                                                <TextBlock.Foreground>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                        <GradientStop Color="#6366F1" Offset="0" />
                                                        <GradientStop Color="#8B5CF6" Offset="1" />
                                                    </LinearGradientBrush>
                                                </TextBlock.Foreground>
                                                <Run Text="â‚ª" FontSize="24" /><Run Text="{Binding DisplayPrice, StringFormat='{}{0:F0}'}" />
                                            </TextBlock>
                                            <!-- Original price strikethrough -->
                                            <TextBlock Text="{Binding Price, StringFormat='â‚ª{0:F0}'}"
                                                       FontSize="18" Foreground="#94A3B8"
                                                       TextDecorations="Strikethrough"
                                                       VerticalAlignment="Center" Margin="12,0,0,4"
                                                       Visibility="{Binding HasDiscount, Converter={StaticResource BoolToVis}}" />
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- Feature list -->
                                <StackPanel Grid.Row="1" Margin="28,20,28,8">
                                    <!-- Time -->
                                    <Border Padding="0,10" BorderBrush="#F1F5F9" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Width="32" Height="32" CornerRadius="8"
                                                    Background="#EEF2FF" Margin="0,0,14,0">
                                                <TextBlock Text="â±" FontSize="15"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="×–×ž×Ÿ ×©×™×ž×•×©"
                                                       FontSize="15" Foreground="#64748B"
                                                       VerticalAlignment="Center" />
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding Minutes, StringFormat='{}{0} ×“×§×•×ª'}"
                                                       FontSize="15" FontWeight="Bold" Foreground="#1E293B"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>

                                    <!-- Prints -->
                                    <Border Padding="0,10" BorderBrush="#F1F5F9" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Width="32" Height="32" CornerRadius="8"
                                                    Background="#F0FDF4" Margin="0,0,14,0">
                                                <TextBlock Text="ðŸ–¨" FontSize="15"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="×ª×§×¦×™×‘ ×”×“×¤×¡×•×ª"
                                                       FontSize="15" Foreground="#64748B"
                                                       VerticalAlignment="Center" />
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding Prints, StringFormat='{}{0}â‚ª'}"
                                                       FontSize="15" FontWeight="Bold" Foreground="#1E293B"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>

                                    <!-- Validity -->
                                    <Border Padding="0,10">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Width="32" Height="32" CornerRadius="8"
                                                    Background="#FFF7ED" Margin="0,0,14,0">
                                                <TextBlock Text="ðŸ“…" FontSize="15"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="×ª×•×§×£"
                                                       FontSize="15" Foreground="#64748B"
                                                       VerticalAlignment="Center" />
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding ValidityDisplay}"
                                                       FontSize="15" FontWeight="Bold" Foreground="#1E293B"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </StackPanel>

                                <!-- Buy button -->
                                <Border Grid.Row="2" Padding="24,8,24,24">
                                    <Button Content="×¨×›×•×© ×¢×›×©×™×•" Style="{StaticResource BtnPrimary}"
                                            Command="{Binding DataContext.SelectPackageCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                            CommandParameter="{Binding}" HorizontalAlignment="Stretch"
                                            Height="50" FontSize="17" />
                                </Border>
                            </Grid>

                            <Border.Triggers>
                                <EventTrigger RoutedEvent="MouseEnter">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ThicknessAnimation Storyboard.TargetName="CardRoot"
                                                                Storyboard.TargetProperty="BorderThickness"
                                                                To="2" Duration="0:0:0.15" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                                <EventTrigger RoutedEvent="MouseLeave">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ThicknessAnimation Storyboard.TargetName="CardRoot"
                                                                Storyboard.TargetProperty="BorderThickness"
                                                                To="1.5" Duration="0:0:0.15" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Border.Triggers>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </ScrollViewer>
</Page>
