<Window x:Class="SionyxKiosk.Views.Controls.FloatingTimer"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        Topmost="True" ShowInTaskbar="False"
        Width="520" Height="80" ResizeMode="NoResize"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <!-- Expand on hover -->
        <Storyboard x:Key="ExpandTimer">
            <DoubleAnimation Storyboard.TargetProperty="Width"
                             To="520" Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction><CubicEase EasingMode="EaseOut" /></DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DetailsPanel" Storyboard.TargetProperty="Opacity"
                             To="1" Duration="0:0:0.2" BeginTime="0:0:0.1" />
            <DoubleAnimation Storyboard.TargetName="ReturnBtn" Storyboard.TargetProperty="Opacity"
                             To="1" Duration="0:0:0.2" BeginTime="0:0:0.1" />
        </Storyboard>

        <!-- Collapse on mouse leave -->
        <Storyboard x:Key="CollapseTimer">
            <DoubleAnimation Storyboard.TargetName="DetailsPanel" Storyboard.TargetProperty="Opacity"
                             To="0" Duration="0:0:0.15" />
            <DoubleAnimation Storyboard.TargetName="ReturnBtn" Storyboard.TargetProperty="Opacity"
                             To="0" Duration="0:0:0.15" />
            <DoubleAnimation Storyboard.TargetProperty="Width"
                             To="230" Duration="0:0:0.25" BeginTime="0:0:0.05">
                <DoubleAnimation.EasingFunction><CubicEase EasingMode="EaseOut" /></DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="MouseEnter">
            <BeginStoryboard Storyboard="{StaticResource ExpandTimer}" />
        </EventTrigger>
        <EventTrigger RoutedEvent="MouseLeave">
            <BeginStoryboard Storyboard="{StaticResource CollapseTimer}" />
        </EventTrigger>
    </Window.Triggers>

    <Border x:Name="TimerBorder" CornerRadius="16" Padding="20,0"
            ClipToBounds="True">
        <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.6">
                <GradientStop Color="#1E1B4B" Offset="0" />
                <GradientStop Color="#312E81" Offset="0.5" />
                <GradientStop Color="#3730A3" Offset="1" />
            </LinearGradientBrush>
        </Border.Background>
        <Border.Effect>
            <DropShadowEffect BlurRadius="28" ShadowDepth="4" Direction="270"
                              Color="#000000" Opacity="0.35" />
        </Border.Effect>
        <Grid VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Time remaining (always visible) -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                <TextBlock x:Name="TimeText" Text="00:00:00"
                           FontSize="28" FontWeight="Bold" FontFamily="Cascadia Code, Consolas"
                           Foreground="White" />
                <TextBlock x:Name="TimeLabel" Text="×–×ž×Ÿ × ×•×ª×¨" FontSize="11"
                           Foreground="#A5B4FC" FontWeight="Medium" Margin="2,1,0,0" />
            </StackPanel>

            <!-- Separator (reveals on hover) -->
            <Border x:Name="DetailsPanel" Grid.Column="1" Opacity="0" IsHitTestVisible="False">
                <StackPanel Orientation="Horizontal">
                    <Border Width="1" Background="#FFFFFF18"
                            Margin="18,8" VerticalAlignment="Stretch" />

                    <!-- Usage time + Print balance -->
                    <StackPanel VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                            <TextBlock Text="â±" FontSize="12" Foreground="#A5B4FC"
                                       VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBlock x:Name="UsageText" Text="00:00" FontSize="16"
                                       FontFamily="Cascadia Code, Consolas"
                                       FontWeight="SemiBold" Foreground="#E0E7FF" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ–¨" FontSize="12" Foreground="#A5B4FC"
                                       VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBlock x:Name="PrintText" Text="0.00 â‚ª" FontSize="16"
                                       FontFamily="Cascadia Code, Consolas"
                                       FontWeight="SemiBold" Foreground="#E0E7FF" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Offline indicator -->
            <Border x:Name="OfflineBadge" Grid.Column="3" Visibility="Collapsed"
                    Background="#FEF3C7" CornerRadius="8" Padding="10,4" Margin="12,0,0,0"
                    VerticalAlignment="Center" HorizontalAlignment="Left">
                <TextBlock Text="âš  Offline" FontSize="12" FontWeight="SemiBold"
                           Foreground="#92400E" />
            </Border>

            <!-- Return button (reveals on hover) -->
            <Button x:Name="ReturnBtn" Grid.Column="4" Opacity="0"
                    ToolTip="×—×–×¨×” ×œ××¤×œ×™×§×¦×™×”" Margin="12,0,0,0"
                    Cursor="Hand" Click="ReturnButton_Click">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bg" CornerRadius="12" Padding="14,8"
                                SnapsToDevicePixels="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#6366F1" Offset="0" />
                                    <GradientStop Color="#818CF8" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="â†©" FontSize="16" Foreground="White"
                                           VerticalAlignment="Center" Margin="0,0,6,0" />
                                <TextBlock Text="×—×–×¨×”" FontSize="13" FontWeight="SemiBold"
                                           Foreground="White" VerticalAlignment="Center" />
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bg" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#818CF8" Offset="0" />
                                            <GradientStop Color="#A5B4FC" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bg" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#4F46E5" Offset="0" />
                                            <GradientStop Color="#6366F1" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </Grid>
    </Border>
</Window>
