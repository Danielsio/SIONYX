<Window x:Class="SionyxKiosk.Views.Dialogs.MessageDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStartupLocation="CenterOwner" Width="560" Height="520"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        FlowDirection="RightToLeft">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Border CornerRadius="18" Background="White" ClipToBounds="True">
        <Border.Effect>
            <DropShadowEffect BlurRadius="32" ShadowDepth="8" Direction="270"
                              Color="#0F172A" Opacity="0.18" />
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- ── HEADER ────────────────────────────────────── -->
            <Border Grid.Row="0" Padding="28,20,28,18">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.3">
                        <GradientStop Color="#5B6CFF" Offset="0" />
                        <GradientStop Color="#6F63F2" Offset="0.5" />
                        <GradientStop Color="#8B5CF6" Offset="1" />
                    </LinearGradientBrush>
                </Border.Background>
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Envelope icon -->
                        <Border Width="38" Height="38" CornerRadius="10"
                                Background="#20FFFFFF" Margin="0,0,14,0">
                            <TextBlock Text="&#xE715;" FontFamily="Segoe MDL2 Assets"
                                       FontSize="17" Foreground="White"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="הודעות" FontSize="19" FontWeight="Bold"
                                       Foreground="White" />
                            <TextBlock x:Name="SubtitleText" Text="טוען..."
                                       FontSize="12" Foreground="#AAFFFFFF" Margin="0,2,0,0" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Close button -->
                    <Button x:Name="CloseBtn" Click="CloseBtn_Click"
                            HorizontalAlignment="Left" VerticalAlignment="Center"
                            Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="CloseBg" Width="30" Height="30"
                                        CornerRadius="15" Background="Transparent">
                                    <TextBlock x:Name="CloseX" Text="✕"
                                               FontSize="14" FontWeight="Bold"
                                               Foreground="#BBFFFFFF"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="CloseBg" Property="Background" Value="#22FFFFFF" />
                                        <Setter TargetName="CloseX" Property="Foreground" Value="White" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>
            </Border>

            <!-- ── MESSAGE LIST ──────────────────────────────── -->
            <Grid Grid.Row="1">

                <!-- Loading state -->
                <StackPanel x:Name="LoadingState" VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="&#xE895;" FontFamily="Segoe MDL2 Assets"
                               FontSize="28" Foreground="{StaticResource PrimaryBrush}"
                               HorizontalAlignment="Center" Margin="0,0,0,10" />
                    <TextBlock Text="טוען הודעות..." FontSize="14"
                               Foreground="{StaticResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Empty state -->
                <StackPanel x:Name="EmptyState" VerticalAlignment="Center"
                            HorizontalAlignment="Center" Visibility="Collapsed">
                    <Border Width="64" Height="64" CornerRadius="32"
                            Background="{StaticResource PrimaryGhostBrush}"
                            HorizontalAlignment="Center" Margin="0,0,0,16">
                        <TextBlock Text="&#xE8F2;" FontFamily="Segoe MDL2 Assets"
                                   FontSize="26" Foreground="{StaticResource PrimaryBrush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <TextBlock Text="אין הודעות חדשות" FontSize="17" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="כל ההודעות נקראו" FontSize="13"
                               Foreground="{StaticResource TextMutedBrush}"
                               HorizontalAlignment="Center" Margin="0,6,0,0" />
                </StackPanel>

                <!-- Messages -->
                <ScrollViewer x:Name="MessageScroll" VerticalScrollBarVisibility="Auto"
                              Padding="20,12,20,8">
                    <ItemsControl x:Name="MessageList" ItemsSource="{Binding Messages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,0,0,14">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Avatar -->
                                        <Border Grid.Column="0" Width="40" Height="40"
                                                CornerRadius="20" Margin="0,0,12,0"
                                                VerticalAlignment="Top">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="#6366F1" Offset="0" />
                                                    <GradientStop Color="#8B5CF6" Offset="1" />
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <TextBlock Text="&#xE77B;" FontFamily="Segoe MDL2 Assets"
                                                       FontSize="16" Foreground="White"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Bubble -->
                                        <Border Grid.Column="1" CornerRadius="4,16,16,16"
                                                Padding="18,14,18,14" MaxWidth="380">
                                            <Border.Background>
                                                <SolidColorBrush Color="#F1F5F9" />
                                            </Border.Background>
                                            <StackPanel>
                                                <!-- Sender + time row -->
                                                <Grid Margin="0,0,0,8">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0"
                                                               Text="{Binding DisplaySender}"
                                                               FontSize="13" FontWeight="Bold"
                                                               Foreground="{StaticResource PrimaryDarkBrush}" />
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding DisplayTime}"
                                                               FontSize="11" Foreground="{StaticResource TextMutedBrush}"
                                                               VerticalAlignment="Center" Margin="12,0,0,0" />
                                                </Grid>

                                                <!-- Message body -->
                                                <TextBlock Text="{Binding DisplayBody}" TextWrapping="Wrap"
                                                           FontSize="14.5" LineHeight="22"
                                                           Foreground="{StaticResource TextPrimaryBrush}" />
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>

            <!-- ── FOOTER ────────────────────────────────────── -->
            <Border Grid.Row="2" Padding="20,14,20,18"
                    BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,1,0,0">
                <Button x:Name="MarkReadBtn" Click="MarkReadBtn_Click"
                        Cursor="Hand" HorizontalAlignment="Stretch">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="ReadBtnBg" CornerRadius="12"
                                    Padding="0,13" HorizontalAlignment="Stretch">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#6366F1" Offset="0" />
                                        <GradientStop Color="#8B5CF6" Offset="1" />
                                    </LinearGradientBrush>
                                </Border.Background>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="&#xE73E;" FontFamily="Segoe MDL2 Assets"
                                               FontSize="15" Foreground="White"
                                               VerticalAlignment="Center" Margin="0,0,10,0" />
                                    <TextBlock x:Name="MarkReadText" Text="סמן הכל כנקרא וסגור"
                                               FontSize="15" FontWeight="SemiBold"
                                               Foreground="White" VerticalAlignment="Center" />
                                </StackPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ReadBtnBg" Property="Opacity" Value="0.9" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="ReadBtnBg" Property="Opacity" Value="0.5" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Border>
        </Grid>
    </Border>
</Window>
